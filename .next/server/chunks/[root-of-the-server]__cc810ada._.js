module.exports=[32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},475,e=>{"use strict";e.i(22734),e.i(14747);let t=[];function r(e,t={}){let n={timestamp:new Date().toISOString(),type:"REQUEST",method:e.method,url:e.url,headers:{"content-type":"function"==typeof e.headers?.get?e.headers.get("content-type"):void 0,"user-agent":"function"==typeof e.headers?.get?e.headers.get("user-agent"):void 0},body:e.body||null,...t};return console.log(`[REQUEST] ${n.method} ${n.url}`,n),i(n),n}function n(e,t,r={}){let s={timestamp:new Date().toISOString(),type:"RESPONSE",statusCode:e,data:t,...r};return console.log(`[RESPONSE] Status ${e}`,s),i(s),s}function s(e,t,r={}){let n={timestamp:new Date().toISOString(),type:"DATABASE",operation:e,table:t,...r};return console.log(`[DATABASE] ${e} on ${t}`,n),i(n),n}function a(e,t={}){let r={timestamp:new Date().toISOString(),type:"ERROR",message:e.message,stack:e.stack,...t};return console.error(`[ERROR] ${e.message}`,r),i(r),r}function i(e){t.push(e),t.length>1e3&&t.shift()}function o(e={}){let r=[...t];return e.type&&(r=r.filter(t=>t.type===e.type)),e.table&&(r=r.filter(t=>t.table===e.table)),e.operation&&(r=r.filter(t=>t.operation===e.operation)),e.limit&&(r=r.slice(-e.limit)),r}e.s(["getLogs",()=>o,"logDatabase",()=>s,"logError",()=>a,"logRequest",()=>r,"logResponse",()=>n])},14348,(e,t,r)=>{let{createClient:n}=e.r(91020);t.exports={getSupabase:function(){let e=process.env.SUPABASE_URL||"",t=process.env.SUPABASE_SERVICE_ROLE_KEY||"";if(!e||!t)throw Error("Supabase configuration missing: set SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY");return n(e,t)}}},8627,(e,t,r)=>{let n=e.r(67200),s=process.env.DATABASE_URL,a=null;if(s&&"string"==typeof s&&s.length>0)try{a=n(s,{max:5,prepare:!0,ssl:"require"}),console.log("[POSTGRES] Client initialized with DATABASE_URL")}catch(e){console.error("[POSTGRES] Failed to initialize client:",e.message),a=null}t.exports=a},54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},46786,(e,t,r)=>{t.exports=e.x("os",()=>require("os"))},4446,(e,t,r)=>{t.exports=e.x("net",()=>require("net"))},55004,(e,t,r)=>{t.exports=e.x("tls",()=>require("tls"))},88947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},14747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},22734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},77953,(e,t,r)=>{let n=e.r(14747);function s(e){return n.extname(e).toLowerCase().slice(1)||"unknown"}t.exports={ALLOWED_EXTENSIONS:[".json",".js",".xml",".html",".txt",".pdf",".png",".jpg",".jpeg",".gif",".svg",".webp",".docx"],IGNORED_DIRS:[".next","node_modules",".git"],getPublicDir:function(){let e=process.env.PUBLIC_DIR;return e&&e.trim()?n.resolve(e):n.join(process.cwd(),"public")},getFileExtension:s,mapFileToTable:function(e){return e.includes(`${n.sep}collections${n.sep}`)?{table:"collections",fileType:"json"}:e.includes(`${n.sep}files${n.sep}`)?{table:"static_files",fileType:s(e)}:e.includes(`${n.sep}config${n.sep}`)?{table:"config_files",fileType:s(e)}:e.includes(`${n.sep}data${n.sep}`)?{table:"data_files",fileType:s(e)}:e.includes(`${n.sep}image${n.sep}`)?{table:"images",fileType:s(e)}:e.includes(`${n.sep}js${n.sep}`)?{table:"javascript_files",fileType:"js"}:e.includes(`${n.sep}resume${n.sep}`)?{table:"resumes",fileType:s(e)}:{table:"unknown",fileType:s(e)}}}},75667,(e,t,r)=>{let n=e.r(67200),{createClient:s}=e.r(91020),a=["collections","static_files","config_files","data_files","images","resumes","javascript_files","sync_manifest"];function i(){let e=function(){let e=process.env.DATABASE_URL;if(!e)return null;try{return n(e,{max:5,prepare:!0,ssl:"prefer"})}catch(e){return console.error("[DBOP] Postgres init error:",e.message),null}}(),t=e?null:function(){let e=process.env.SUPABASE_URL||"",t=process.env.SUPABASE_SERVICE_ROLE_KEY||"";if(!e||!t)return null;try{return s(e,t)}catch(e){return console.error("[DBOP] Supabase init error:",e.message),null}}(),r=e?"postgres":t?"supabase":"none";if("none"===r)throw Error("No database configured: set DATABASE_URL or SUPABASE_URL + SUPABASE_SERVICE_ROLE_KEY");return{mode:r,sql:e,supabase:t}}async function o(){let{mode:e,sql:t,supabase:r}=i(),n=["CREATE TABLE IF NOT EXISTS collections (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), lang VARCHAR(10), type VARCHAR(20), filename VARCHAR(255), file_content JSONB, file_hash VARCHAR(64), synced_at TIMESTAMP DEFAULT now(), created_at TIMESTAMP DEFAULT now(), updated_at TIMESTAMP DEFAULT now(), UNIQUE(lang, type, filename))","CREATE TABLE IF NOT EXISTS static_files (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), filename VARCHAR(255) UNIQUE, file_type VARCHAR(50), file_content TEXT, file_hash VARCHAR(64), synced_at TIMESTAMP DEFAULT now(), created_at TIMESTAMP DEFAULT now(), updated_at TIMESTAMP DEFAULT now())","CREATE TABLE IF NOT EXISTS config_files (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), filename VARCHAR(255) UNIQUE, file_type VARCHAR(50), file_content JSONB, file_hash VARCHAR(64), synced_at TIMESTAMP DEFAULT now(), created_at TIMESTAMP DEFAULT now(), updated_at TIMESTAMP DEFAULT now())","CREATE TABLE IF NOT EXISTS data_files (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), filename VARCHAR(255) UNIQUE, file_type VARCHAR(50), file_content JSONB, file_hash VARCHAR(64), synced_at TIMESTAMP DEFAULT now(), created_at TIMESTAMP DEFAULT now(), updated_at TIMESTAMP DEFAULT now())","CREATE TABLE IF NOT EXISTS images (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), filename VARCHAR(255) UNIQUE, file_path VARCHAR(512), mime_type VARCHAR(50), file_hash VARCHAR(64), synced_at TIMESTAMP DEFAULT now(), created_at TIMESTAMP DEFAULT now(), updated_at TIMESTAMP DEFAULT now())","CREATE TABLE IF NOT EXISTS resumes (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), filename VARCHAR(255) UNIQUE, file_type VARCHAR(50), file_path VARCHAR(512), file_hash VARCHAR(64), synced_at TIMESTAMP DEFAULT now(), created_at TIMESTAMP DEFAULT now(), updated_at TIMESTAMP DEFAULT now())","CREATE TABLE IF NOT EXISTS javascript_files (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), filename VARCHAR(255) UNIQUE, file_path VARCHAR(512), file_content TEXT, file_hash VARCHAR(64), synced_at TIMESTAMP DEFAULT now(), created_at TIMESTAMP DEFAULT now(), updated_at TIMESTAMP DEFAULT now())","CREATE TABLE IF NOT EXISTS sync_manifest (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), file_path VARCHAR(512) UNIQUE, file_hash VARCHAR(64), table_name VARCHAR(50), last_synced TIMESTAMP DEFAULT now())","CREATE INDEX IF NOT EXISTS idx_collections_lang ON collections(lang)","CREATE INDEX IF NOT EXISTS idx_sync_manifest_path ON sync_manifest(file_path)"];if("postgres"===e){let e=0;for(let r of n)try{await t.unsafe(r),e++}catch(e){console.warn("[DBOP] createDB warn:",e.message)}return{status:"success",operation:"createdb",statements_executed:e}}{let e=0;for(let t of n)try{await r.rpc("exec_sql",{sql:t}),e++}catch(e){String(e.message).includes("exists")||console.warn("[DBOP] createDB warn:",e.message)}return{status:"success",operation:"createdb",statements_executed:e}}}async function l(){let{mode:e,sql:t,supabase:r}=i(),n=0;if("postgres"===e)for(let e of a)try{await t.unsafe(`DELETE FROM ${e}`),n++}catch(t){console.warn("[DBOP] delete warn:",e,t.message)}else for(let e of a)try{await r.from(e).delete().neq("id",null),n++}catch(t){console.warn("[DBOP] delete warn:",e,t.message)}return{status:"success",operation:"deletedb",tables_cleared:n}}async function c(e){let{mode:t,sql:r,supabase:n}=i();if("postgres"===t)try{let t=await r`SELECT COUNT(*)::int AS count FROM ${r(e)}`;return t?.[0]?.count||0}catch{return 0}try{let{count:t}=await n.from(e).select("*",{count:"exact",head:!0});return t||0}catch{return 0}}async function E(){let{mode:e,sql:t,supabase:r}=i();if("postgres"===e)try{return await t`SELECT file_path, file_hash, table_name FROM sync_manifest`}catch{return[]}{let{data:e,error:t}=await r.from("sync_manifest").select("*");return t?[]:e||[]}}async function A(e){let{mode:t,sql:r,supabase:n}=i();if("postgres"===t)try{return await r`
        INSERT INTO sync_manifest (file_path, file_hash, table_name, last_synced)
        VALUES (${e.file_path}, ${e.file_hash}, ${e.table_name}, ${e.last_synced})
        ON CONFLICT (file_path) DO UPDATE SET file_hash = EXCLUDED.file_hash, table_name = EXCLUDED.table_name, last_synced = EXCLUDED.last_synced
      `,!0}catch{return!1}try{return await n.from("sync_manifest").upsert(e,{onConflict:"file_path"}),!0}catch{return!1}}t.exports={db:i,createdb:o,deletedb:l,count:c,getManifest:E,upsertManifest:A,TABLES:a}}];

//# sourceMappingURL=%5Broot-of-the-server%5D__cc810ada._.js.map