module.exports=[32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},46786,(e,t,r)=>{t.exports=e.x("os",()=>require("os"))},4446,(e,t,r)=>{t.exports=e.x("net",()=>require("net"))},55004,(e,t,r)=>{t.exports=e.x("tls",()=>require("tls"))},88947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},14747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},22734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},77953,(e,t,r)=>{let s=e.r(14747);function n(e){return s.extname(e).toLowerCase().slice(1)||"unknown"}t.exports={ALLOWED_EXTENSIONS:[".json",".js",".xml",".html",".txt",".pdf",".png",".jpg",".jpeg",".gif",".svg",".webp",".docx"],IGNORED_DIRS:[".next","node_modules",".git"],getPublicDir:function(){let e=process.env.PUBLIC_DIR;return e&&e.trim()?s.resolve(e):s.join(process.cwd(),"public")},getFileExtension:n,mapFileToTable:function(e){return e.includes(`${s.sep}collections${s.sep}`)?{table:"collections",fileType:"json"}:e.includes(`${s.sep}files${s.sep}`)?{table:"static_files",fileType:n(e)}:e.includes(`${s.sep}config${s.sep}`)?{table:"config_files",fileType:n(e)}:e.includes(`${s.sep}data${s.sep}`)?{table:"data_files",fileType:n(e)}:e.includes(`${s.sep}image${s.sep}`)?{table:"images",fileType:n(e)}:e.includes(`${s.sep}js${s.sep}`)?{table:"javascript_files",fileType:"js"}:e.includes(`${s.sep}resume${s.sep}`)?{table:"resumes",fileType:n(e)}:{table:"unknown",fileType:n(e)}}}},75667,(e,t,r)=>{let s=e.r(67200),{createClient:n}=e.r(91020),a=["collections","static_files","config_files","data_files","images","resumes","javascript_files","sync_manifest"];function i(){let e=function(){let e=process.env.DATABASE_URL;if(!e)return null;try{return s(e,{max:5,prepare:!0,ssl:"prefer"})}catch(e){return console.error("[DBOP] Postgres init error:",e.message),null}}(),t=e?null:function(){let e=process.env.SUPABASE_URL||"",t=process.env.SUPABASE_SERVICE_ROLE_KEY||"";if(!e||!t)return null;try{return n(e,t)}catch(e){return console.error("[DBOP] Supabase init error:",e.message),null}}(),r=e?"postgres":t?"supabase":"none";if("none"===r)throw Error("No database configured: set DATABASE_URL or SUPABASE_URL + SUPABASE_SERVICE_ROLE_KEY");return{mode:r,sql:e,supabase:t}}async function l(){let{mode:e,sql:t,supabase:r}=i(),s=["CREATE TABLE IF NOT EXISTS collections (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), lang VARCHAR(10), type VARCHAR(20), filename VARCHAR(255), file_content JSONB, file_hash VARCHAR(64), synced_at TIMESTAMP DEFAULT now(), created_at TIMESTAMP DEFAULT now(), updated_at TIMESTAMP DEFAULT now(), UNIQUE(lang, type, filename))","CREATE TABLE IF NOT EXISTS static_files (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), filename VARCHAR(255) UNIQUE, file_type VARCHAR(50), file_content TEXT, file_hash VARCHAR(64), synced_at TIMESTAMP DEFAULT now(), created_at TIMESTAMP DEFAULT now(), updated_at TIMESTAMP DEFAULT now())","CREATE TABLE IF NOT EXISTS config_files (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), filename VARCHAR(255) UNIQUE, file_type VARCHAR(50), file_content JSONB, file_hash VARCHAR(64), synced_at TIMESTAMP DEFAULT now(), created_at TIMESTAMP DEFAULT now(), updated_at TIMESTAMP DEFAULT now())","CREATE TABLE IF NOT EXISTS data_files (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), filename VARCHAR(255) UNIQUE, file_type VARCHAR(50), file_content JSONB, file_hash VARCHAR(64), synced_at TIMESTAMP DEFAULT now(), created_at TIMESTAMP DEFAULT now(), updated_at TIMESTAMP DEFAULT now())","CREATE TABLE IF NOT EXISTS images (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), filename VARCHAR(255) UNIQUE, file_path VARCHAR(512), mime_type VARCHAR(50), file_hash VARCHAR(64), synced_at TIMESTAMP DEFAULT now(), created_at TIMESTAMP DEFAULT now(), updated_at TIMESTAMP DEFAULT now())","CREATE TABLE IF NOT EXISTS resumes (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), filename VARCHAR(255) UNIQUE, file_type VARCHAR(50), file_path VARCHAR(512), file_hash VARCHAR(64), synced_at TIMESTAMP DEFAULT now(), created_at TIMESTAMP DEFAULT now(), updated_at TIMESTAMP DEFAULT now())","CREATE TABLE IF NOT EXISTS javascript_files (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), filename VARCHAR(255) UNIQUE, file_path VARCHAR(512), file_content TEXT, file_hash VARCHAR(64), synced_at TIMESTAMP DEFAULT now(), created_at TIMESTAMP DEFAULT now(), updated_at TIMESTAMP DEFAULT now())","CREATE TABLE IF NOT EXISTS sync_manifest (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), file_path VARCHAR(512) UNIQUE, file_hash VARCHAR(64), table_name VARCHAR(50), last_synced TIMESTAMP DEFAULT now())","CREATE INDEX IF NOT EXISTS idx_collections_lang ON collections(lang)","CREATE INDEX IF NOT EXISTS idx_sync_manifest_path ON sync_manifest(file_path)"];if("postgres"===e){let e=0;for(let r of s)try{await t.unsafe(r),e++}catch(e){console.warn("[DBOP] createDB warn:",e.message)}return{status:"success",operation:"createdb",statements_executed:e}}{let e=0;for(let t of s)try{await r.rpc("exec_sql",{sql:t}),e++}catch(e){String(e.message).includes("exists")||console.warn("[DBOP] createDB warn:",e.message)}return{status:"success",operation:"createdb",statements_executed:e}}}async function o(){let{mode:e,sql:t,supabase:r}=i(),s=0;if("postgres"===e)for(let e of a)try{await t.unsafe(`DELETE FROM ${e}`),s++}catch(t){console.warn("[DBOP] delete warn:",e,t.message)}else for(let e of a)try{await r.from(e).delete().neq("id",null),s++}catch(t){console.warn("[DBOP] delete warn:",e,t.message)}return{status:"success",operation:"deletedb",tables_cleared:s}}async function c(e){let{mode:t,sql:r,supabase:s}=i();if("postgres"===t)try{let t=await r`SELECT COUNT(*)::int AS count FROM ${r(e)}`;return t?.[0]?.count||0}catch{return 0}try{let{count:t}=await s.from(e).select("*",{count:"exact",head:!0});return t||0}catch{return 0}}async function A(){let{mode:e,sql:t,supabase:r}=i();if("postgres"===e)try{return await t`SELECT file_path, file_hash, table_name FROM sync_manifest`}catch{return[]}{let{data:e,error:t}=await r.from("sync_manifest").select("*");return t?[]:e||[]}}async function E(e){let{mode:t,sql:r,supabase:s}=i();if("postgres"===t)try{return await r`
        INSERT INTO sync_manifest (file_path, file_hash, table_name, last_synced)
        VALUES (${e.file_path}, ${e.file_hash}, ${e.table_name}, ${e.last_synced})
        ON CONFLICT (file_path) DO UPDATE SET file_hash = EXCLUDED.file_hash, table_name = EXCLUDED.table_name, last_synced = EXCLUDED.last_synced
      `,!0}catch{return!1}try{return await s.from("sync_manifest").upsert(e,{onConflict:"file_path"}),!0}catch{return!1}}t.exports={db:i,createdb:l,deletedb:o,count:c,getManifest:A,upsertManifest:E,TABLES:a}}];

//# sourceMappingURL=%5Broot-of-the-server%5D__18c1ea90._.js.map