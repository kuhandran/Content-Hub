module.exports=[49728,(e,t,a)=>{let n=e.r(22734),s=e.r(14747),i=e.r(54799),{NextResponse:r}=e.r(89171),{createClient:l}=e.r(91020);function o(e){return s.extname(e).toLowerCase().slice(1)||"unknown"}async function c(e){let t,a,r=(t=s.join(process.cwd(),"public"),a=new Map,!function e(r){if(n.existsSync(r))for(let l of n.readdirSync(r,{withFileTypes:!0})){let c=s.join(r,l.name),u=s.relative(t,c);if(l.isDirectory())[".next","node_modules",".git"].includes(l.name)||e(c);else if([".json",".js",".xml",".html",".txt",".pdf",".png",".jpg",".jpeg",".gif",".svg",".webp",".docx"].includes(s.extname(c)))try{let e=n.readFileSync(c,"utf-8"),t=i.createHash("sha256").update(e).digest("hex"),{table:s,fileType:r}=c.includes("/collections/")?{table:"collections",fileType:"json"}:c.includes("/files/")?{table:"static_files",fileType:o(c)}:c.includes("/config/")?{table:"config_files",fileType:o(c)}:c.includes("/data/")?{table:"data_files",fileType:o(c)}:c.includes("/image/")?{table:"images",fileType:o(c)}:c.includes("/js/")?{table:"javascript_files",fileType:"js"}:c.includes("/resume/")?{table:"resumes",fileType:o(c)}:{table:"unknown",fileType:o(c)};"unknown"!==s&&a.set(u,{hash:t,content:e,table:s,fileType:r})}catch(e){}}}(t),a),l=[],c=0,u=0,d=0;try{let{data:t,error:a}=await e.from("sync_manifest").select("*");if(a)throw Error(`Failed to fetch sync_manifest: ${a.message}`);let n=new Map(t?.map(e=>[e.file_path,e])||[]);for(let[e,t]of r){let a=n.get(e);a?a.file_hash!==t.hash&&(l.push({path:s.join("public",e),relativePath:e,status:"modified",table:t.table,hash:t.hash,fileType:t.fileType}),u++):(l.push({path:s.join("public",e),relativePath:e,status:"new",table:t.table,hash:t.hash,fileType:t.fileType}),c++)}for(let[e,t]of n)!r.has(e)&&(l.push({path:s.join("public",e),relativePath:e,status:"deleted",table:t.table_name,hash:t.file_hash,fileType:o(e)}),d++);return{changes:l,stats:{files_scanned:r.size,new_files:c,modified_files:u,deleted_files:d}}}catch(e){throw Error(`Scan failed: ${e.message}`)}}async function u(e,t){let a=0,i=s.join(process.cwd(),"public");for(let r of t)try{let t=s.join(i,r.relativePath);if("deleted"===r.status){let{error:t}=await e.from(r.table).delete().match({file_path:r.relativePath});!t&&a++}else if("new"===r.status||"modified"===r.status){let i=n.readFileSync(t,"utf-8"),l=new Date().toISOString(),o=s.basename(t,s.extname(t)),c={};if("collections"===r.table){let e=r.relativePath.split(s.sep),t=e.findIndex(e=>"collections"===e),a=e[t+1],n=e[t+2];try{let e=JSON.parse(i);c={lang:a,type:n,filename:o,file_content:e,file_hash:r.hash,synced_at:l}}catch{continue}}else if(["config_files","data_files"].includes(r.table))try{let e=JSON.parse(i);c={filename:o,file_type:r.fileType,file_content:e,file_hash:r.hash,synced_at:l}}catch{continue}else c="static_files"===r.table?{filename:o,file_type:r.fileType,file_content:i,file_hash:r.hash,synced_at:l}:{filename:o,file_path:r.relativePath,file_type:r.fileType,file_hash:r.hash,synced_at:l};let{error:u}=await e.from(r.table).upsert(c,{onConflict:"filename"});u||(a++,await e.from("sync_manifest").upsert({file_path:r.relativePath,file_hash:r.hash,table_name:r.table,last_synced:l},{onConflict:"file_path"}))}}catch(e){console.error(`Failed to apply change ${r.relativePath}: ${e.message}`)}return{status:"completed",applied:a}}t.exports={POST:async function(e){try{let t=(await e.json()).mode||"scan",a=l(process.env.SUPABASE_URL||"",process.env.SUPABASE_SERVICE_ROLE_KEY||""),n=new Date().toISOString();if("scan"===t){let{changes:e,stats:t}=await c(a);return r.json({status:"success",mode:"scan",...t,changes:e.slice(0,100),timestamp:n})}if("pull"===t){let{changes:e,stats:t}=await c(a);return await u(a,e),r.json({status:"success",mode:"pull",...t,changes:e.slice(0,50),timestamp:n})}if("push"===t)return r.json({status:"error",mode:"push",error:"Push mode is not yet implemented",timestamp:n},{status:501});else return r.json({status:"error",mode:t,error:`Unknown mode: ${t}. Use 'scan', 'pull', or 'push'`,timestamp:n},{status:400})}catch(e){return r.json({status:"error",mode:"unknown",error:e.message||"Internal server error",timestamp:new Date().toISOString()},{status:500})}},GET:async function(e){return r.json({status:"success",message:"Sync endpoint is active",available_modes:["scan","pull","push"],usage:'POST /api/admin/sync with { mode: "scan" | "pull" | "push" }',timestamp:new Date().toISOString()})}}},48828,e=>{"use strict";var t=e.i(47909),a=e.i(74017),n=e.i(96250),s=e.i(59756),i=e.i(61916),r=e.i(74677),l=e.i(69741),o=e.i(16795),c=e.i(87718),u=e.i(95169),d=e.i(47587),p=e.i(66012),h=e.i(70101),f=e.i(26937),m=e.i(10372),y=e.i(93695);e.i(52474);var w=e.i(220),_=e.i(49728);let g=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/admin/sync/route",pathname:"/api/admin/sync",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/admin/sync/route.js",nextConfigOutput:"",userland:_}),{workAsyncStorage:R,workUnitAsyncStorage:v,serverHooks:b}=g;function E(){return(0,n.patchFetch)({workAsyncStorage:R,workUnitAsyncStorage:v})}async function T(e,t,n){g.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let _="/api/admin/sync/route";_=_.replace(/\/index$/,"")||"/";let R=await g.prepare(e,t,{srcPage:_,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:v,params:b,nextConfig:E,parsedUrl:T,isDraftMode:x,prerenderManifest:S,routerServerContext:C,isOnDemandRevalidate:P,revalidateOnlyGenerated:A,resolvedPathname:j,clientReferenceManifest:O,serverActionsManifest:N}=R,I=(0,l.normalizeAppPath)(_),U=!!(S.dynamicRoutes[I]||S.routes[j]),k=async()=>((null==C?void 0:C.render404)?await C.render404(e,t,T,!1):t.end("This page could not be found"),null);if(U&&!x){let e=!!S.routes[j],t=S.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await k();throw new y.NoFallbackError}}let D=null;!U||g.isDev||x||(D="/index"===(D=j)?"/":D);let H=!0===g.isDev||!U,q=U&&!H;N&&O&&(0,r.setManifestsSingleton)({page:_,clientReferenceManifest:O,serverActionsManifest:N});let M=e.method||"GET",$=(0,i.getTracer)(),F=$.getActiveScopeSpan(),K={params:b,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,n,s)=>g.onRequestError(e,t,n,s,C)},sharedContext:{buildId:v}},L=new o.NodeNextRequest(e),B=new o.NodeNextResponse(t),G=c.NextRequestAdapter.fromNodeNextRequest(L,(0,c.signalFromNodeResponse)(t));try{let r=async e=>g.handle(G,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=$.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=a.get("next.route");if(n){let t=`${M} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${_}`)}),l=!!(0,s.getRequestMeta)(e,"minimalMode"),o=async s=>{var i,o;let c=async({previousCacheEntry:a})=>{try{if(!l&&P&&A&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await r(s);e.fetchMetrics=K.renderOpts.fetchMetrics;let o=K.renderOpts.pendingWaitUntil;o&&n.waitUntil&&(n.waitUntil(o),o=void 0);let c=K.renderOpts.collectedTags;if(!U)return await (0,p.sendResponse)(L,B,i,K.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(i.headers);c&&(t[m.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,n=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:n}}}}catch(t){throw(null==a?void 0:a.isStale)&&await g.onRequestError(e,t,{routerKind:"App Router",routePath:_,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:P})},!1,C),t}},u=await g.handleResponse({req:e,nextConfig:E,cacheKey:D,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:A,responseGenerator:c,waitUntil:n.waitUntil,isMinimalMode:l});if(!U)return null;if((null==u||null==(i=u.value)?void 0:i.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(o=u.value)?void 0:o.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",P?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let y=(0,h.fromNodeOutgoingHttpHeaders)(u.value.headers);return l&&U||y.delete(m.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||y.get("Cache-Control")||y.set("Cache-Control",(0,f.getCacheControlHeader)(u.cacheControl)),await (0,p.sendResponse)(L,B,new Response(u.value.body,{headers:y,status:u.value.status||200})),null};F?await o(F):await $.withPropagatedContext(e.headers,()=>$.trace(u.BaseServerSpan.handleRequest,{spanName:`${M} ${_}`,kind:i.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},o))}catch(t){if(t instanceof y.NoFallbackError||await g.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:P})},!1,C),U)throw t;return await (0,p.sendResponse)(L,B,new Response(null,{status:500})),null}}e.s(["handler",()=>T,"patchFetch",()=>E,"routeModule",()=>g,"serverHooks",()=>b,"workAsyncStorage",()=>R,"workUnitAsyncStorage",()=>v])}];

//# sourceMappingURL=_54b313d6._.js.map