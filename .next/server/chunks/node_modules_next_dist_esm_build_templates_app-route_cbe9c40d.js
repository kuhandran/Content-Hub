module.exports=[93333,e=>{"use strict";var t=e.i(47909),a=e.i(74017),s=e.i(96250),r=e.i(59756),n=e.i(61916),o=e.i(74677),l=e.i(69741),i=e.i(16795),u=e.i(87718),d=e.i(95169),c=e.i(47587),p=e.i(66012),f=e.i(70101),R=e.i(26937),E=e.i(10372),h=e.i(93695);e.i(52474);var g=e.i(220),m=e.i(22734),x=e.i(14747),N=e.i(54799),A=e.i(75667),T=e.i(14348),w=e.i(77953),v=e.i(8627),y=e.i(89171),b=e.i(475);let{getSupabase:C}=T.default,D=C(),{mapFileToTable:j,ALLOWED_EXTENSIONS:S,IGNORED_DIRS:I,getPublicDir:P}=w.default;function O(){let e=P(),t=[];return!function a(s){if(m.default.existsSync(s))for(let r of m.default.readdirSync(s,{withFileTypes:!0})){let n=x.default.join(s,r.name),o=x.default.relative(e,n);if(r.isDirectory())I.includes(r.name)||a(n);else if(S.includes(x.default.extname(n).toLowerCase()))try{let e=m.default.readFileSync(n,"utf-8"),a=N.default.createHash("sha256").update(e).digest("hex"),{table:s,fileType:r}=j(n);"unknown"!==s&&t.push({path:n,relativePath:o,content:e,hash:a,table:s,fileType:r})}catch(e){console.warn(`⚠️  Failed to read: ${n}`)}}}(e),t}async function $(e){(0,b.logRequest)(e);try{let{action:t,table:a,payload:s,id:r}=await e.json();if("pump"===t){if("1"===process.env.VERCEL)return y.NextResponse.json({status:"error",error:'The "pump" action is not available in the Vercel serverless environment. Please use this feature locally or migrate your ingestion logic to cloud storage.'},{status:400});try{let e=O();console.log("[ADMIN DATA] Files scanned:",e.length)}catch(e){return console.log("[ADMIN DATA] Pump Exception:",e.message),y.NextResponse.json({status:"error",error:e.message},{status:500})}}else if("clear"===t)try{let e=A.default.TABLES,t=0;for(let a of e)try{await D.from(a).delete().neq("id",null),t++,console.log("[ADMIN DATA] Cleared table:",a)}catch(e){console.warn("[ADMIN DATA] Clear Exception:",e.message)}try{console.log("[ADMIN DATA] Redis cache simulated for clear")}catch(e){console.log("[ADMIN DATA] Redis Exception:",e.message)}return y.NextResponse.json({status:"success",action:"clear",tables_cleared:t})}catch(e){return console.log("[ADMIN DATA] Clear Exception:",e.message),y.NextResponse.json({status:"error",error:e.message},{status:500})}else if("create"===t&&a&&s)try{if(!A.default.TABLES.includes(a))return y.NextResponse.json({status:"error",error:"Invalid table"},{status:400});if(v.default){let e=Object.keys(s),t=e.map(e=>s[e]),r=e.map(e=>`"${e}"`).join(", "),n=t.map((e,t)=>`$${t+1}`).join(", "),o=`INSERT INTO ${a} (${r}) VALUES (${n}) RETURNING *`,l=await v.default.unsafe(o,t);return(0,b.logDatabase)("INSERT",a,{payload:s}),(0,b.logResponse)(200,l),y.NextResponse.json({status:"success",data:l})}{let{data:e,error:t}=await D.from(a).insert(s).select();if(t)throw t;return(0,b.logDatabase)("INSERT",a,{payload:s}),(0,b.logResponse)(200,e),y.NextResponse.json({status:"success",data:e})}}catch(e){return(0,b.logError)(e),y.NextResponse.json({status:"error",error:e.message},{status:500})}else if("read"===t&&a)try{if(!A.default.TABLES.includes(a))return y.NextResponse.json({status:"error",error:"Invalid table"},{status:400});if(v.default){let e=await v.default.unsafe(`SELECT * FROM ${a}`);return(0,b.logDatabase)("SELECT",a),(0,b.logResponse)(200,e),y.NextResponse.json({status:"success",data:e})}{let{data:e,error:t}=await D.from(a).select("*");if(t)throw t;return(0,b.logDatabase)("SELECT",a),(0,b.logResponse)(200,e),y.NextResponse.json({status:"success",data:e})}}catch(e){return(0,b.logError)(e),y.NextResponse.json({status:"error",error:e.message},{status:500})}else if("update"===t&&a&&r&&s)try{if(!A.default.TABLES.includes(a))return y.NextResponse.json({status:"error",error:"Invalid table"},{status:400});if(v.default){let e=Object.keys(s),t=e.map(e=>s[e]),n=e.map((e,t)=>`"${e}" = $${t+1}`).join(", "),o=`UPDATE ${a} SET ${n} WHERE id = $${e.length+1} RETURNING *`,l=await v.default.unsafe(o,[...t,r]);return(0,b.logDatabase)("UPDATE",a,{id:r,payload:s}),(0,b.logResponse)(200,l),y.NextResponse.json({status:"success",data:l})}{let{data:e,error:t}=await D.from(a).update(s).eq("id",r).select();if(t)throw t;return(0,b.logDatabase)("UPDATE",a,{id:r,payload:s}),(0,b.logResponse)(200,e),y.NextResponse.json({status:"success",data:e})}}catch(e){return(0,b.logError)(e),y.NextResponse.json({status:"error",error:e.message},{status:500})}else if("delete"===t&&a&&r)try{if(!A.default.TABLES.includes(a))return y.NextResponse.json({status:"error",error:"Invalid table"},{status:400});if(v.default){let e=await v.default.unsafe(`DELETE FROM ${a} WHERE id = $1 RETURNING *`,[r]);return(0,b.logDatabase)("DELETE",a,{id:r}),(0,b.logResponse)(200,e),y.NextResponse.json({status:"success",data:e})}{let{data:e,error:t}=await D.from(a).delete().eq("id",r).select();if(t)throw t;return(0,b.logDatabase)("DELETE",a,{id:r}),(0,b.logResponse)(200,e),y.NextResponse.json({status:"success",data:e})}}catch(e){return(0,b.logError)(e),y.NextResponse.json({status:"error",error:e.message},{status:500})}return y.NextResponse.json({status:"error",error:"Invalid action. Use: pump, clear, create, read, update, delete"},{status:400})}catch(e){return(0,b.logError)(e),y.NextResponse.json({status:"error",error:e.message},{status:500})}}async function U(){try{let e=O(),t={};for(let a of e)t[a.table]=(t[a.table]||0)+1;let a={};for(let e of A.default.TABLES)a[e]=await A.default.count(e);return y.NextResponse.json({status:"success",public_folder:{total_files:e.length,by_type:t},database:a,timestamp:new Date().toISOString()})}catch(e){return(0,b.logError)(e),y.NextResponse.json({status:"error",error:e.message},{status:500})}}e.s(["GET",()=>U,"POST",()=>$],62693);var _=e.i(62693);let M=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/admin/data/route",pathname:"/api/admin/data",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/admin/data/route.js",nextConfigOutput:"",userland:_}),{workAsyncStorage:H,workUnitAsyncStorage:L,serverHooks:q}=M;function k(){return(0,s.patchFetch)({workAsyncStorage:H,workUnitAsyncStorage:L})}async function F(e,t,s){M.isDev&&(0,r.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let m="/api/admin/data/route";m=m.replace(/\/index$/,"")||"/";let x=await M.prepare(e,t,{srcPage:m,multiZoneDraftMode:!1});if(!x)return t.statusCode=400,t.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:N,params:A,nextConfig:T,parsedUrl:w,isDraftMode:v,prerenderManifest:y,routerServerContext:b,isOnDemandRevalidate:C,revalidateOnlyGenerated:D,resolvedPathname:j,clientReferenceManifest:S,serverActionsManifest:I}=x,P=(0,l.normalizeAppPath)(m),O=!!(y.dynamicRoutes[P]||y.routes[j]),$=async()=>((null==b?void 0:b.render404)?await b.render404(e,t,w,!1):t.end("This page could not be found"),null);if(O&&!v){let e=!!y.routes[j],t=y.dynamicRoutes[P];if(t&&!1===t.fallback&&!e){if(T.experimental.adapterPath)return await $();throw new h.NoFallbackError}}let U=null;!O||M.isDev||v||(U="/index"===(U=j)?"/":U);let _=!0===M.isDev||!O,H=O&&!_;I&&S&&(0,o.setManifestsSingleton)({page:m,clientReferenceManifest:S,serverActionsManifest:I});let L=e.method||"GET",q=(0,n.getTracer)(),k=q.getActiveScopeSpan(),F={params:A,prerenderManifest:y,renderOpts:{experimental:{authInterrupts:!!T.experimental.authInterrupts},cacheComponents:!!T.cacheComponents,supportsDynamicResponse:_,incrementalCache:(0,r.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:T.cacheLife,waitUntil:s.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,s,r)=>M.onRequestError(e,t,s,r,b)},sharedContext:{buildId:N}},B=new i.NodeNextRequest(e),K=new i.NodeNextResponse(t),G=u.NextRequestAdapter.fromNodeNextRequest(B,(0,u.signalFromNodeResponse)(t));try{let o=async e=>M.handle(G,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=q.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=a.get("next.route");if(s){let t=`${L} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${L} ${m}`)}),l=!!(0,r.getRequestMeta)(e,"minimalMode"),i=async r=>{var n,i;let u=async({previousCacheEntry:a})=>{try{if(!l&&C&&D&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await o(r);e.fetchMetrics=F.renderOpts.fetchMetrics;let i=F.renderOpts.pendingWaitUntil;i&&s.waitUntil&&(s.waitUntil(i),i=void 0);let u=F.renderOpts.collectedTags;if(!O)return await (0,p.sendResponse)(B,K,n,F.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(n.headers);u&&(t[E.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=E.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,s=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=E.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:s}}}}catch(t){throw(null==a?void 0:a.isStale)&&await M.onRequestError(e,t,{routerKind:"App Router",routePath:m,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:C})},!1,b),t}},d=await M.handleResponse({req:e,nextConfig:T,cacheKey:U,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:D,responseGenerator:u,waitUntil:s.waitUntil,isMinimalMode:l});if(!O)return null;if((null==d||null==(n=d.value)?void 0:n.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(i=d.value)?void 0:i.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",C?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),v&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,f.fromNodeOutgoingHttpHeaders)(d.value.headers);return l&&O||h.delete(E.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,R.getCacheControlHeader)(d.cacheControl)),await (0,p.sendResponse)(B,K,new Response(d.value.body,{headers:h,status:d.value.status||200})),null};k?await i(k):await q.withPropagatedContext(e.headers,()=>q.trace(d.BaseServerSpan.handleRequest,{spanName:`${L} ${m}`,kind:n.SpanKind.SERVER,attributes:{"http.method":L,"http.target":e.url}},i))}catch(t){if(t instanceof h.NoFallbackError||await M.onRequestError(e,t,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:C})},!1,b),O)throw t;return await (0,p.sendResponse)(B,K,new Response(null,{status:500})),null}}e.s(["handler",()=>F,"patchFetch",()=>k,"routeModule",()=>M,"serverHooks",()=>q,"workAsyncStorage",()=>H,"workUnitAsyncStorage",()=>L],93333)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_cbe9c40d.js.map