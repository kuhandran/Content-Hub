{"version":3,"sources":["../../../lib/logger.js"],"sourcesContent":["import fs from 'fs';\nimport path from 'path';\n\n// Log file path - in .next/static for Vercel (writable)\nconst getLogPath = () => {\n  const dir = path.join(process.cwd(), '.next/static/logs');\n  if (!fs.existsSync(dir)) {\n    try {\n      fs.mkdirSync(dir, { recursive: true });\n    } catch (error) {\n      console.error('Could not create log directory:', error);\n    }\n  }\n  return path.join(dir, 'api-logs.jsonl');\n};\n\nconst logs = [];\nconst MAX_LOGS = 1000; // Keep last 1000 logs in memory\n\nexport function logRequest(req, context = {}) {\n  const log = {\n    timestamp: new Date().toISOString(),\n    type: 'REQUEST',\n    method: req.method,\n    url: req.url,\n    headers: {\n      // Next.js Request uses the WHATWG Headers API\n      'content-type': typeof req.headers?.get === 'function' ? req.headers.get('content-type') : undefined,\n      'user-agent': typeof req.headers?.get === 'function' ? req.headers.get('user-agent') : undefined,\n    },\n    body: req.body || null,\n    ...context,\n  };\n  \n  // IMPORTANT: Log to console so it appears in Vercel logs\n  console.log(`[REQUEST] ${log.method} ${log.url}`, log);\n  \n  addLog(log);\n  return log;\n}\n\nexport function logResponse(statusCode, data, context = {}) {\n  const log = {\n    timestamp: new Date().toISOString(),\n    type: 'RESPONSE',\n    statusCode,\n    data,\n    ...context,\n  };\n  \n  // IMPORTANT: Log to console so it appears in Vercel logs\n  console.log(`[RESPONSE] Status ${statusCode}`, log);\n  \n  addLog(log);\n  return log;\n}\n\nexport function logDatabase(operation, table, details = {}) {\n  const log = {\n    timestamp: new Date().toISOString(),\n    type: 'DATABASE',\n    operation, // SELECT, INSERT, UPDATE, DELETE, CREATE, DROP\n    table,\n    ...details,\n  };\n  \n  // IMPORTANT: Log to console so it appears in Vercel logs\n  console.log(`[DATABASE] ${operation} on ${table}`, log);\n  \n  addLog(log);\n  return log;\n}\n\nexport function logError(error, context = {}) {\n  const log = {\n    timestamp: new Date().toISOString(),\n    type: 'ERROR',\n    message: error.message,\n    stack: error.stack,\n    ...context,\n  };\n  \n  // IMPORTANT: Log to console so it appears in Vercel logs\n  console.error(`[ERROR] ${error.message}`, log);\n  \n  addLog(log);\n  return log;\n}\n\nfunction addLog(log) {\n  logs.push(log);\n  \n  // Keep only last MAX_LOGS in memory\n  if (logs.length > MAX_LOGS) {\n    logs.shift();\n  }\n\n  // Note: File writing disabled for Vercel (ephemeral filesystem)\n  // All logs are available via console.log (visible in Vercel dashboard) and in-memory storage\n}\n\nexport function getLogs(filter = {}) {\n  let filtered = [...logs];\n\n  if (filter.type) {\n    filtered = filtered.filter(log => log.type === filter.type);\n  }\n\n  if (filter.table) {\n    filtered = filtered.filter(log => log.table === filter.table);\n  }\n\n  if (filter.operation) {\n    filtered = filtered.filter(log => log.operation === filter.operation);\n  }\n\n  if (filter.limit) {\n    filtered = filtered.slice(-filter.limit);\n  }\n\n  return filtered;\n}\n\nexport function clearLogs() {\n  logs.length = 0;\n  console.log('[LOGS] Cleared all in-memory logs');\n}\n"],"names":[],"mappings":"stCAAA,EAAA,CAAA,CAAA,OACA,EAAA,CAAA,CAAA,OAeA,IAAM,EAAO,EAAE,CAGR,SAAS,EAAW,CAAG,CAAE,EAAU,CAAC,CAAC,EAC1C,IAAM,EAAM,CACV,UAAW,IAAI,OAAO,WAAW,GACjC,KAAM,UACN,OAAQ,EAAI,MAAM,CAClB,IAAK,EAAI,GAAG,CACZ,QAAS,CAEP,eAA4C,YAA5B,OAAO,EAAI,OAAO,EAAE,IAAqB,EAAI,OAAO,CAAC,GAAG,CAAC,qBAAkB,EAC3F,aAAc,AAA4B,mBAArB,EAAI,OAAO,EAAE,IAAqB,EAAI,OAAO,CAAC,GAAG,CAAC,mBAAgB,CACzF,EACA,KAAM,EAAI,IAAI,EAAI,KAClB,GAAG,CAAO,AACZ,EAMA,OAHA,QAAQ,GAAG,CAAC,CAAC,UAAU,EAAE,EAAI,MAAM,CAAC,CAAC,EAAE,EAAI,GAAG,CAAA,CAAE,CAAE,GAElD,EAAO,GACA,CACT,CAEO,SAAS,EAAY,CAAU,CAAE,CAAI,CAAE,EAAU,CAAC,CAAC,EACxD,IAAM,EAAM,CACV,UAAW,IAAI,OAAO,WAAW,GACjC,KAAM,WACN,kBACA,EACA,GAAG,CAAO,AACZ,EAMA,OAHA,QAAQ,GAAG,CAAC,CAAC,kBAAkB,EAAE,EAAA,CAAY,CAAE,GAE/C,EAAO,GACA,CACT,CAEO,SAAS,EAAY,CAAS,CAAE,CAAK,CAAE,EAAU,CAAC,CAAC,EACxD,IAAM,EAAM,CACV,UAAW,IAAI,OAAO,WAAW,GACjC,KAAM,WACN,kBACA,EACA,GAAG,CAAO,AACZ,EAMA,OAHA,QAAQ,GAAG,CAAC,CAAC,WAAW,EAAE,EAAU,IAAI,EAAE,EAAA,CAAO,CAAE,GAEnD,EAAO,GACA,CACT,CAEO,SAAS,EAAS,CAAK,CAAE,EAAU,CAAC,CAAC,EAC1C,IAAM,EAAM,CACV,UAAW,IAAI,OAAO,WAAW,GACjC,KAAM,QACN,QAAS,EAAM,OAAO,CACtB,MAAO,EAAM,KAAK,CAClB,GAAG,CAAO,AACZ,EAMA,OAHA,QAAQ,KAAK,CAAC,CAAC,QAAQ,EAAE,EAAM,OAAO,CAAA,CAAE,CAAE,GAE1C,EAAO,GACA,CACT,CAEA,SAAS,EAAO,CAAG,EACjB,EAAK,IAAI,CAAC,GAGN,EAAK,MAAM,CA5EA,EA4EG,GAChB,CA7EmB,CA6Ed,KADqB,AAChB,EAKd,CAEO,SAAS,EAAQ,EAAS,CAAC,CAAC,EACjC,IAAI,EAAW,AArFsC,IAqFlC,EAAK,CAkBxB,OAhBI,EAAO,IAAI,EAAE,CACf,EAAW,EAAS,MAAM,CAAC,GAAO,EAAI,IAAI,GAAK,EAAO,KAAI,EAGxD,EAAO,KAAK,EAAE,AAChB,GAAW,EAAS,MAAM,CAAC,GAAO,EAAI,KAAK,GAAK,EAAO,MAAK,EAG1D,EAAO,SAAS,EAAE,CACpB,EAAW,EAAS,MAAM,CAAC,GAAO,EAAI,SAAS,GAAK,EAAO,UAAS,EAGlE,EAAO,KAAK,EAAE,CAChB,EAAW,EAAS,KAAK,CAAC,CAAC,EAAO,MAAK,EAGlC,CACT"}